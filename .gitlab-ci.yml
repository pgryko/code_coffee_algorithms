test cpp:
  # use the official gcc image, based on debian
  # can use verions as well, like gcc:5.2
  # see https://hub.docker.com/_/gcc/
  image: gcc

  # Is performed before the scripts in the stages step
  before_script:
    - apt-get update
    - apt-get -y install cmake python3-pip python3-scipy
    - git submodule update --init --recursive
  stage: test
  script:
    - cmake -H. -Bbuild
    - cd build;
    - make
    - ./unit_tests --gtest_output="xml:cpp_junit.xml"

  artifacts:
    reports:
      junit:
       - build/cpp_junit.xml

test python:
  image: gcc

  # Is performed before the scripts in the stages step
  before_script:
    - apt-get update
    - apt-get -y install cmake python3-pip python3-scipy
    - git submodule update --init --recursive
  stage: test
  script:
    - python3 -V # print version of python3
    - pip3 install -r requirements.txt
    - pytest --junitxml=build/pytest.xml --cov=src/
    - black src --check
    - flake8 --ignore=E501, W503, E722, E203 --max-line-length=100 --select=src/
  artifacts:
    reports:
      junit:
       - build/pytest.xml

sonarcloud-check:
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  image:
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script:
    - sonar-scanner -Dsonar.c.file.suffixes=- -Dsonar.cpp.file.suffixes=- -Dsonar.objc.file.suffixes=- \
  only:
    - merge_requests
    - master
    - develop

